{% extends "samples/base.html" %}

{% block title %}Submit Sample{% endblock %}

{% block content %}

<section class="content-header">
  <div class="container-fluid">
    <h1>Submit Analysis Task</h1>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      <div class="col-md-8">
        
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Task Details</h3>
          </div>
          <div class="card-body">
            <form method="post" novalidate>
              {% csrf_token %}
              
              <div class="form-group">
                <label for="{{ form.sha256.id_for_label }}">SHA256 Hash</label>
                {{ form.sha256 }}
                {% if form.sha256.errors %}
                  <div class="text-danger small">
                    {{ form.sha256.errors }}
                  </div>
                {% else %}
                  <small class="form-text text-muted">64 character hexadecimal hash</small>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.download_link.id_for_label }}">Download Link</label>
                {{ form.download_link }}
                {% if form.download_link.errors %}
                  <div class="text-danger small">
                    {{ form.download_link.errors }}
                  </div>
                {% else %}
                  <small class="form-text text-muted">URL where the sample can be downloaded</small>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.goal.id_for_label }}">Analysis Goal</label>
                {{ form.goal }}
                {% if form.goal.errors %}
                  <div class="text-danger small">
                    {{ form.goal.errors }}
                  </div>
                {% else %}
                  <small class="form-text text-muted">What should be learned or achieved through this analysis?</small>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.description.id_for_label }}">Description</label>
                {{ form.description }}
                {% if form.description.errors %}
                  <div class="text-danger small">
                    {{ form.description.errors }}
                  </div>
                {% else %}
                  <small class="form-text text-muted">Detailed information about the sample (will be hidden as spoiler)</small>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.difficulty.id_for_label }}">Difficulty Level</label>
                {{ form.difficulty }}
                {% if form.difficulty.errors %}
                  <div class="text-danger small">
                    {{ form.difficulty.errors }}
                  </div>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.tags.id_for_label }}">Tags</label>
                {{ form.tags }}
                {% if form.tags.errors %}
                  <div class="text-danger small">
                    {{ form.tags.errors }}
                  </div>
                {% else %}
                  <small class="form-text text-muted">Comma-separated tags (e.g., ransomware, "string deobfuscation")</small>
                {% endif %}
              </div>

              <div class="form-group">
                <label for="{{ form.tools.id_for_label }}">Tools</label>
                {{ form.tools }}
                {% if form.tools.errors %}
                  <div class="text-danger small">
                    {{ form.tools.errors }}
                  </div>
                {% else %}
                  <small class="form-text text-muted">Comma-separated tools (e.g., ghidra, x64dbg)</small>
                {% endif %}
              </div>

              {% if form.non_field_errors %}
                <div class="alert alert-danger">
                  {{ form.non_field_errors }}
                </div>
              {% endif %}

              <div class="form-group mb-0">
                <button type="submit" class="btn btn-danger">
                  <i class="fas fa-save"></i> Submit 
                </button>
                <a href="{% url 'sample_list' %}" class="btn btn-secondary">
                  <i class="fas fa-times"></i> Cancel
                </a>
              </div>
            </form>
          </div>
        </div>

      </div>
      
      <div class="col-md-4">
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Submission Guidelines</h3>
          </div>
          <div class="card-body">
            <ul class="mb-0">
              <li class="mb-2">Provide a valid SHA256 hash (64 hex characters), if the download consists of several files, use the hash of the archive</li>
              <li class="mb-2">Download link should be to malshare or malwarebazaar (for now)</li>
              <li class="mb-2">Choose the appropriate difficulty level, see explanation below</li>
            </ul>
          </div>
        </div>
        
        <div class="card">
          <div class="card-header">
            <h3 class="card-title">Difficulty Levels</h3>
          </div>
          <div class="card-body">
            <h6 class="text-info">Easy</h6>
            <p class="small mb-3">
              Easy samples are not packed or obfuscated or have trivial obfuscation like base64. They should only use favorable execution environments (no Rust or Go). Samples must not be self-modifying. Samples can be inside of installers (NSIS) or basic wrappers (Batch2Exe) which drop the non-packed payload to disk.
            </p>
            
            <h6 class="text-warning">Medium</h6>
            <p class="small mb-3">
              Medium samples are easy to unpack (if packed) and can have some obfuscation or simple anti-reversing techniques. Deobfuscation should not require to change the control flow. But deobfuscation may require to decrypt strings or data. Execution environment can be somewhat unfavorable for current tooling.
            </p>
            
            <h6 class="text-danger">Advanced</h6>
            <p class="small mb-0">
              Advanced samples may require to write custom tooling for unpacking or deobfuscation. They may employ several anti-reversing mechanisms or self-modifying code. They may use control flow obfuscation. They may use unusual execution environments without good RE tooling or use packers which require more work for unpacking than just setting a few breakpoints.
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}
