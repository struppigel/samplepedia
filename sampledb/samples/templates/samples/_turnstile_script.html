{% comment %}
Reusable Turnstile button enable script
Usage: {% include 'samples/_turnstile_script.html' with button_id='submit-button' callback_name='enableSubmitButton' %}
{% endcomment %}
<script>
  // Enable submit button after Turnstile challenge succeeds
  function {{ callback_name }}() {
    document.getElementById('{{ button_id }}').disabled = false;
  }
  
  // Add callback attribute to Turnstile widget
  document.addEventListener('DOMContentLoaded', function() {
    const turnstileWidget = document.querySelector('.cf-turnstile');
    if (turnstileWidget) {
      turnstileWidget.setAttribute('data-callback', '{{ callback_name }}');
      
      // Also check if already solved
      const observer = new MutationObserver(function(mutations) {
        const response = turnstileWidget.querySelector('input[name="cf-turnstile-response"]');
        if (response && response.value) {
          {{ callback_name }}();
          observer.disconnect();
        }
      });
      observer.observe(turnstileWidget, { childList: true, subtree: true });
      
      // Check immediately
      const response = turnstileWidget.querySelector('input[name="cf-turnstile-response"]');
      if (response && response.value) {
        {{ callback_name }}();
      }
    }
  });
</script>
